<!DOCTYPE html>
<html>

<head>
	<title>Todo App</title>
	<!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
</head>

<body style="background-color:cadetblue">
	<div id="app">
		<h1>Todo App</h1>
		<input type="text" id="newTodoInput">
		<input type="button" id="addTodoButton" value="Add Todo"/>
		<ul id="todoList"></ul>
	</div>
	<script>
		// Function to send a POST request to the server
		async function addTodo() {
			const input = document.getElementById("newTodoInput");
			const item = input.value;
			input.value = "";

			const response = await fetch("/cgi-bin/todo/crud.py", {
				method: "POST",
				headers: {
					"Content-Type": "text/plain"
				},
				body: JSON.stringify({ item })
			});
			if (response.ok) {
				const data = await response.json();
				console.log(data);
				if (data.success) {
					const todoList = document.getElementById("todoList");
					const li = document.createElement("li");
					li.textContent = item;
					todoList.appendChild(li);
				} else {
					alert("Failed to add todo");
				}
			} else {
				console.log(response);
			}
		}

		// Function to fetch and display all todo items
		async function displayTodos() {
			const response = await fetch("/cgi-bin/todo/crud.py", {
				method: "GET"
			});
			if (!response.ok) {
				console.error("Error:", response);
				// alert("Failed to fetch todos");
				return;
			}
			const data = await response.json();
			console.log(data);
			const todoList = document.getElementById("todoList");
			todoList.innerHTML = ""; // Clear the existing list
			console.log(data);
			data.forEach(todo => {
				const li = document.createElement("li");
				li.textContent = todo;
				todoList.appendChild(li);
			});
		}

		document.getElementById("addTodoButton").addEventListener("click", async function (event) {
			event.preventDefault();
			await addTodo();
		});

		document.addEventListener("DOMContentLoaded", await displayTodos);
	</script>
</body>

</html>